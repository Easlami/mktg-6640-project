---
title: "Radar Sentiment by Topic"
author: "Riley Walburger"
date: "2025-07-27"
output: html_document
---

## Load Packages 
```{r}

warning(suppressMessages(library(tidyverse))) 
library(quanteda)
library(janitor)
library(here)
library(skimr)
library(tidytext)
library(SnowballC)

```
## Load Data
```{r}

raw_reviews <- read_csv(here("C:/Users/walbr/Desktop/U of U/3- Summer Semester 2025/Text Analysis/Group Project/Restaurant_Data.csv")) %>% 
  clean_names()

raw_reviews$style[is.na(raw_reviews$style)] <- "Missing"
raw_reviews$price[is.na(raw_reviews$price)] <- "Missing"  # or another method

# Create factor vars 
raw_reviews <- raw_reviews %>% 
  mutate(across(c(style, price), factor))

```

```{r}
topics <- c(
  "Food Quality",
  "Service",
  "Cleanliness & Hygiene",
  "Atmosphere & Ambience",
  "Price & Value",
  "Wait Times",
  "Order Accuracy",
  "Beverages",
  "Location & Accessibility",
  "Takeout & Delivery Experience",
  "Special Occasions",
  "Authenticity / Cuisine-Specific Expectations",
  "Technology Experience"
)
```

```{r}
# Assuming your raw_reviews table is already loaded
comments_tokens <- raw_reviews %>%
  select(comment) %>%
  unnest_tokens(word, comment) %>%
  anti_join(get_stopwords(), by = "word") %>%
  mutate(word = wordStem(word))  # optional: stemming
```

```{r}
bing_sentiments <- get_sentiments("bing")

comments_sentiment <- comments_tokens %>%
  inner_join(bing_sentiments, by = "word") %>%
  count(word, sentiment, sort = TRUE)

```

```{r}
topic_keywords <- list(
  "Food Quality" = c("tast", "flavor", "fresh", "portion", "deliciou", "undercook"),
  "Service" = c("staff", "waiter", "friendli", "rude", "attent", "slow"),
  "Cleanliness & Hygiene" = c("clean", "dirty", "hygien", "bathroom", "messi"),
  "Atmosphere & Ambience" = c("music", "loud", "quiet", "decor", "ambienc"),
  "Price & Value" = c("price", "expens", "cheap", "deal", "worth", "valu"),
  "Wait Times" = c("wait", "slow", "fast", "time", "long", "delay"),
  "Order Accuracy" = c("wrong", "correct", "mistak", "order", "forgot"),
  "Beverages" = c("drink", "cocktail", "wine", "beer", "coffee", "beverag"),
  "Location & Accessibility" = c("park", "locat", "find", "access", "near"),
  "Takeout & Delivery Experience" = c("deliveri", "takeout", "cold", "late", "packag"),
  "Special Occasions" = c("birthday", "anniversari", "special", "celebr", "group"),
  "Authenticity / Cuisine-Specific Expectations" = c("authent", "tradit", "real", "cuisin", "fusion"),
  "Technology Experience" = c("app", "qr", "reserv", "system", "onlin", "order")
)

```

```{r}
assign_topic <- function(word) {
  for (topic in names(topic_keywords)) {
    if (word %in% topic_keywords[[topic]]) return(topic)
  }
  return(NA)
}

comments_sentiment <- comments_sentiment %>%
  mutate(topic = map_chr(word, assign_topic)) %>%
  filter(!is.na(topic))

```

```{r}
sentiment_summary <- comments_sentiment %>%
  group_by(topic, sentiment) %>%
  summarise(n = sum(n), .groups = "drop") %>%
  pivot_wider(names_from = sentiment, values_from = n, values_fill = 0) %>%
  mutate(net_sentiment = positive - negative)
```

```{r}
print(sentiment_summary)

```
## Radar Chart

```{r}
library(fmsb)
library(dplyr)

```

```{r}
# Ensure all topics are present and fill missing with 0
topics_ordered <- c(
  "Food Quality", "Service", "Cleanliness & Hygiene", "Atmosphere & Ambience",
  "Price & Value", "Wait Times", "Order Accuracy", "Beverages",
  "Location & Accessibility", "Takeout & Delivery Experience", "Special Occasions",
  "Authenticity / Cuisine-Specific Expectations", "Technology Experience"
)

sentiment_radar <- sentiment_summary %>%
  select(topic, net_sentiment) %>%
  right_join(data.frame(topic = topics_ordered), by = "topic") %>%
  arrange(match(topic, topics_ordered)) %>%
  mutate(net_sentiment = replace_na(net_sentiment, 0)) %>%
  column_to_rownames("topic") %>%
  t() %>%
  as.data.frame()

# Add max/min rows required by fmsb
radar_data <- rbind(
  rep(max(sentiment_radar), ncol(sentiment_radar)),  # max values
  rep(min(sentiment_radar), ncol(sentiment_radar)),  # min values
  sentiment_radar                                    # actual values
)

```

```{r}
radarchart(
  radar_data,
  axistype = 1,
  pcol = "#1f77b4",
  pfcol = "#1f77b420",
  plwd = 3,
  cglcol = "grey", 
  cglty = 1, 
  axislabcol = "grey",
  caxislabels = seq(min(radar_data[2,]), max(radar_data[1,]), length.out = 5),
  cglwd = 0.8,
  vlcex = 0.8
)
title("Net Sentiment by Restaurant Topic")
```

## Break it down by Group

```{r}
# Define topic keywords
topic_keywords <- list(
  "Food Quality" = c("tast", "flavor", "fresh", "portion", "deliciou", "undercook"),
  "Service" = c("staff", "waiter", "friendli", "rude", "attent", "slow"),
  "Cleanliness & Hygiene" = c("clean", "dirty", "hygien", "bathroom", "messi"),
  "Atmosphere & Ambience" = c("music", "loud", "quiet", "decor", "ambienc"),
  "Price & Value" = c("price", "expens", "cheap", "deal", "worth", "valu"),
  "Wait Times" = c("wait", "slow", "fast", "time", "long", "delay"),
  "Order Accuracy" = c("wrong", "correct", "mistak", "order", "forgot"),
  "Beverages" = c("drink", "cocktail", "wine", "beer", "coffee", "beverag"),
  "Location & Accessibility" = c("park", "locat", "find", "access", "near"),
  "Takeout & Delivery Experience" = c("deliveri", "takeout", "cold", "late", "packag"),
  "Special Occasions" = c("birthday", "anniversari", "special", "celebr", "group"),
  "Authenticity / Cuisine-Specific Expectations" = c("authent", "tradit", "real", "cuisin", "fusion"),
  "Technology Experience" = c("app", "qr", "reserv", "system", "onlin", "order")
)

assign_topic <- function(word) {
  for (topic in names(topic_keywords)) {
    if (word %in% topic_keywords[[topic]]) return(topic)
  }
  return(NA)
}
```


```{r}
# All Korean
korean_reviews <- raw_reviews %>% filter(str_detect(style, "Korean"))

# Top-ranked Korean
top_korean <- raw_reviews %>% filter(str_detect(style, "Korean"), rank < 26)

# Low-ranked Korean (excluding The Barn)
low_korean <- raw_reviews %>% 
  filter(str_detect(style, "Korean"), rank > 150, restaurant_name != "The Barn Cafe & Restaurant")

# Seong Buk Dong
seong_buk_dong <- raw_reviews %>% filter(restaurant_name == "Seong Buk Dong")
```

```{r}
get_sentiment_by_topic <- function(df) {
  df %>%
    unnest_tokens(word, comment) %>%
    anti_join(get_stopwords(), by = "word") %>%
    mutate(word = wordStem(word)) %>%
    inner_join(get_sentiments("bing"), by = "word") %>%
    mutate(topic = map_chr(word, assign_topic)) %>%
    filter(!is.na(topic)) %>%
    count(topic, sentiment, sort = TRUE) %>%
    pivot_wider(names_from = sentiment, values_from = n, values_fill = 0) %>%
    mutate(net_sentiment = positive - negative)
}

```


```{r}
sents_overall <- get_sentiment_by_topic(korean_reviews) %>%
  rename(overall = net_sentiment)

sents_top <- get_sentiment_by_topic(top_korean) %>%
  rename(top = net_sentiment)

sents_low <- get_sentiment_by_topic(low_korean) %>%
  rename(low = net_sentiment)

sents_sbd <- get_sentiment_by_topic(seong_buk_dong) %>%
  rename(seongbukdong = net_sentiment)
```

```{r}
combined <- full_join(sents_overall, sents_top, by = "topic") %>%
  full_join(sents_low, by = "topic") %>%
  full_join(sents_sbd, by = "topic") %>%
  replace_na(list(overall = 0, top = 0, low = 0, seongbukdong = 0)) %>%
  arrange(topic)

# Prep for radar: rows = groups, columns = topics
radar_ready <- combined %>%
  column_to_rownames("topic") %>%
  t() %>%
  as.data.frame()

# Add max/min for fmsb
radar_chart_data <- rbind(
  rep(max(radar_ready), ncol(radar_ready)),
  rep(min(radar_ready), ncol(radar_ready)),
  radar_ready
)
```


```{r}
# Convert all columns to numeric (unlist if needed)
radar_ready <- combined %>%
  column_to_rownames("topic") %>%
  t() %>%
  as.data.frame()

# Convert factors or lists to numeric
radar_ready[] <- lapply(radar_ready, function(x) {
  if(is.list(x)) {
    return(as.numeric(unlist(x)))
  } else {
    return(as.numeric(x))
  }
})

# Then add max/min rows for fmsb
radar_chart_data <- rbind(
  rep(max(radar_ready, na.rm = TRUE), ncol(radar_ready)),
  rep(min(radar_ready, na.rm = TRUE), ncol(radar_ready)),
  radar_ready
)
```


```{r}
colors_border <- c("black", "forestgreen", "red", "blue")
colors_fill <- adjustcolor(colors_border, alpha.f = 0.2)

par(mar = c(1, 1, 2, 6))  # bigger right margin
radarchart(
  radar_chart_data,
  axistype = 1,
  pcol = colors_border,
  pfcol = colors_fill,
  plwd = 3,
  plty = c(0,0,1,1,1,1),
  cglcol = "grey",
  caxislabels = seq(min(radar_chart_data[2, ]), max(radar_chart_data[1, ]), length.out = 5),
  cglty = 1,
  cglwd = 0.8,
  vlcex = 0.8
)
legend(
  x = 1.3, y = 1.1,
  legend = c("All Korean", "Top Korean", "Low Korean", "Seong Buk Dong"),
  bty = "n",
  pch = 20,
  col = colors_border,
  text.col = "black",
  cex = 0.8,
  pt.cex = 2
)
```


